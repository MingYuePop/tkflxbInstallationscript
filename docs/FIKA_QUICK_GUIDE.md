# Fika 联机功能快速指南

## 快速开始

### 房主模式（创建服务器）

```
1. 主菜单 → 4) 其他 → 5) Fika 联机功能
2. 选择 1) 启动联机
   - 首次使用会自动下载并安装 Fika MOD
   - 登录游戏一次完成初始化，然后退出
3. 选择 2) 创建服务器
   - 输入你的公网 IP（如：123.45.67.89）
   - 启动游戏
4. 将你的公网 IP 分享给其他玩家
```

### 客户端模式（加入服务器）

```
1. 主菜单 → 4) 其他 → 5) Fika 联机功能
2. 选择 1) 启动联机
   - 首次使用会自动下载并安装 Fika MOD
   - 登录游戏一次完成初始化，然后退出
3. 选择 3) 加入服务器
   - 输入房主的公网 IP（从房主处获取）
   - 输入你自己的公网 IP
   - 启动游戏
4. 在游戏中连接到房主的服务器
```

### 关闭联机

```
1. 主菜单 → 4) 其他 → 5) Fika 联机功能
2. 选择 4) 关闭联机
   - 如果游戏正在运行，会提示关闭游戏
   - 确认删除所有联机组件
3. 游戏恢复到单机模式
```

---

## 重要提示

### 房主必读
- ⚠️ **端口转发**：必须在路由器上配置 6969 端口转发
- ⚠️ **防火墙**：确保防火墙允许 6969 端口的入站连接
- ⚠️ **公网 IP**：确保你有公网 IP（不是内网 IP）

### 客户端必读
- ✅ 需要知道房主的公网 IP
- ✅ 需要自己的公网 IP（用于 P2P 连接）
- ✅ 确保网络稳定

---

## 常见配置

### 如何查看公网 IP？
访问以下任一网站：
- https://ip.sb
- https://whatismyip.com
- https://ipinfo.io

### 路由器端口转发示例
```
外部端口：6969
内部端口：6969
协议：TCP + UDP
内部 IP：你的电脑局域网 IP（如 192.168.1.100）
```

### 防火墙规则示例（Windows）
```powershell
# 允许入站连接
netsh advfirewall firewall add rule name="SPT Fika Server" dir=in action=allow protocol=TCP localport=6969
netsh advfirewall firewall add rule name="SPT Fika Server UDP" dir=in action=allow protocol=UDP localport=6969
```

---

## 故障排查

### 问题：无法下载 Fika MOD
**解决方案**：
- 检查网络连接
- 确认 announcement.json 中的下载链接有效
- 手动下载 MOD 并放入 `resources/mods` 文件夹

### 问题：客户端无法连接到房主
**解决方案**：
1. 确认房主已正确配置端口转发
2. 使用在线工具测试端口是否开放：https://www.yougetsignal.com/tools/open-ports/
3. 检查输入的 IP 地址是否正确
4. 尝试关闭防火墙测试（测试后记得重新开启）

### 问题：游戏启动后崩溃
**解决方案**：
1. 确保 Fika MOD 版本与游戏版本兼容
2. 检查是否有其他冲突的 MOD
3. 查看游戏日志文件：`BepInEx/LogOutput.log`
4. 尝试重新安装联机功能

### 问题：配置文件修改失败
**解决方案**：
- 确保游戏已完全关闭
- 检查文件是否为只读属性
- 以管理员身份运行安装器

---

## 进阶配置

### 自定义端口
如需修改默认端口（6969），需要手动编辑以下文件：
1. `SPT/user/launcher/config.json` → 修改 `Server.Url` 中的端口
2. 路由器端口转发规则中修改对应端口

### 局域网联机
如果在同一局域网内联机，可以使用内网 IP：
- 房主使用内网 IP（如 192.168.1.100）
- 客户端连接到房主的内网 IP
- 无需配置端口转发

---

## 技术支持

遇到问题？
- 📱 官方交流群：1067632016
- 🌐 官方网站：tkf.pyden.dev
- 📖 完整文档：[FIKA_ONLINE_FEATURE.md](./FIKA_ONLINE_FEATURE.md)
