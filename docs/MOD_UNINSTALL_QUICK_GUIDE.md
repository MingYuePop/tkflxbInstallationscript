# MOD 删除功能 - 快速指南

## 用户使用流程

### 安装 MOD
1. 启动安装器
2. 选择菜单选项 `4) 其他`
3. 选择 `3) 安装内置 MOD`
4. 选择要安装的 MOD
5. 确认安装
6. ✓ MOD 安装完成，文件列表自动记录

### 删除 MOD
1. 启动安装器
2. 选择菜单选项 `4) 其他`
3. 选择 `4) 删除已安装的 MOD` ← **新功能**
4. 查看已安装的 MOD 列表
5. 选择要删除的 MOD
6. 确认删除（显示将删除的文件数量）
7. ✓ MOD 删除完成，记录自动清除

## 标记文件示例

安装 MOD 后，`.spt_installed.json` 会自动更新：

```json
{
  "version": "4.0.5",
  "mods": {
    "MyMod": {
      "files": [
        "Mods/MyMod/file1.txt",
        "Mods/MyMod/file2.dat"
      ],
      "installed_at": "2025-11-24T13:05:00"
    }
  }
}
```

## 常见问题

### Q: 删除 MOD 时提示"文件未找到，已跳过"
**A:** 这是正常的。可能是：
- 文件已被手动删除
- 文件被其他程序移动
- 磁盘权限问题

系统会自动跳过这些文件，继续删除其他文件。

### Q: 能否删除单个 MOD 中的某些文件？
**A:** 目前不支持。删除 MOD 时会删除该 MOD 的所有文件。如需删除单个文件，请手动操作。

### Q: 删除 MOD 后能否恢复？
**A:** 不能。删除是永久性的。建议在删除前备份重要文件。

### Q: 能否同时安装多个 MOD？
**A:** 可以。每个 MOD 独立记录，互不影响。

### Q: 如果两个 MOD 包含相同文件会怎样？
**A:** 系统会分别记录。删除一个 MOD 时只删除该 MOD 记录的文件。如果两个 MOD 共享文件，删除第一个 MOD 会删除该文件，第二个 MOD 的记录仍存在但文件已不存在（删除时会自动跳过）。

## 技术细节

### 文件记录方式
- 记录的是**相对于游戏根目录**的路径
- 仅记录**文件**，不记录目录
- 使用 Windows 路径分隔符（`\`）或 Unix 路径分隔符（`/`）都支持

### 删除流程
1. 读取标记文件中的 MOD 记录
2. 逐个删除文件（文件不存在自动跳过）
3. 从标记文件中删除 MOD 记录
4. 显示删除统计

### 安全保障
- ✓ 删除前二次确认
- ✓ 显示将删除的文件数量
- ✓ 文件不存在自动跳过
- ✓ 删除失败显示错误信息
- ✓ 部分删除失败不中断流程

## 开发者信息

### 相关代码
- 核心函数：`scripts/installers.py` 中的 `uninstall_mod()`
- 辅助函数：
  - `_record_mod_installation()` - 记录 MOD 文件
  - `_get_mod_files()` - 获取 MOD 文件列表
  - `_remove_mod_record()` - 删除 MOD 记录

### 标记文件字段
```python
{
    "mods": {
        "MOD名称": {
            "files": ["相对路径1", "相对路径2", ...],
            "installed_at": "ISO 时间戳"
        }
    }
}
```

### 测试命令
```bash
python test_mod_uninstall.py
```

## 版本信息
- 功能版本：1.0
- 实现日期：2025-11-24
- 兼容性：SPT 4.0.5+
